(function(){var a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u=function(a,b){return function(){return a.apply(b,arguments)}},v=Object.prototype.hasOwnProperty,w=function(a,b){function d(){this.constructor=a}for(var c in b)v.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a},x=Array.prototype.slice,y=Array.prototype.indexOf||function(a){for(var b=0,c=this.length;b<c;b++)if(this[b]===a)return b;return-1};b=function(){function a(a,b,c){this.name=a,this.path=b,this.config=c}return a}(),e=function(){function a(a){this.verbose=u(this.verbose,this),this.error=u(this.error,this),this.eventlog=u(this.eventlog,this),this.log=u(this.log,this),this.setDebug=u(this.setDebug,this),this.config={},this.environment={},this.performance={tools:{fpsstats:{show:function(a){var b;b=new Stats,b.domElement.style.position="absolute",b.domElement.style.left="50px",b.domElement.style.top="50px",b.domElement.style.opacity=.7,b.domElement.id="js_fps_stats",console.log("stats",b),$("body").append(b.domElement),setInterval(function(){return b.update()},1e3/60)},hide:function(a){$("#js_fps_stats").hide()}}}},this.debug={logging:!0,eventlog:!0,verbose:!0}}return w(a,b),a.prototype.setDebug=function(a){return this.debug=a,console.log("[CoreDev] Debug has been set.",this.debug)},a.prototype.log=function(){var a,b,c;c=arguments[0],b=arguments[1],a=3<=arguments.length?x.call(arguments,2):[],a==null&&(a="{no context}"),this.debug.logging===!0&&console.log.apply(console,["["+c+"] INFO: "+b].concat(x.call(a)))},a.prototype.eventlog=function(){var a,b;b=arguments[0],a=2<=arguments.length?x.call(arguments,1):[],a==null&&(a="{no context}"),this.debug.eventlog===!0&&console.log.apply(console,["[EventLog] "+b].concat(x.call(a)))},a.prototype.error=function(){var a,b,c;c=arguments[0],b=arguments[1],a=3<=arguments.length?x.call(arguments,2):[],this.debug.logging===!0&&console.log.apply(console,["["+c+"] ERROR: "+b].concat(x.call(a)))},a.prototype.verbose=function(){var a,b,c;c=arguments[0],b=arguments[1],a=3<=arguments.length?x.call(arguments,2):[],this.debug.verbose===!0&&this.log.apply(this,[c,b].concat(x.call(a)))},a}(),j=function(){function a(a){this.version={minor:null,major:null,release:null,setVersion:function(a,b,c){this.minor=a,this.major=b,this.release=c}},this.drivers={registry:{},register:u(function(b,c,d,e,f,g){var h;this.drivers.registry[b]==null&&(this.drivers.registry[b]={}),this.drivers.registry[b][c]={initialized:f,preference:e,registered:!0,hook_point:d,init_callback:g},h={module:b,name:c,hook:d},a.state.events.triggerEvent("DRIVER_REGISTERED",h)},this),resolve:function(a,b){var c,d,e,f,g,h;if(this.registry[a]==null)return!1;if(b!=null)return this.registry[a][b]==null?!1:this.registry[a][b].hook_point;h=null,g=null,f=0;for(e in this.registry[a]){d=this.registry[a][e];if(d.preference!=null){typeof d.preference=="function"?typeof $!="undefined"&&$!==null?c=d.preference($.fatcatmap):c=d.preference(window.fatcatmap):c=d.preference;if(c!==null&&typeof c!="boolean")c>f&&(g=d);else{if(c===!1)continue;if(c===!0)g=d;else continue}}else h=d}return g!==null?g.hook_point:h!==null?h.hook_point:null}}}return w(a,b),a}(),d=function(){function a(a){this._data={},this.platform={},this.capabilities={},this._data={browsers:[{string:navigator.userAgent,subString:"Chrome",identity:"Chrome"},{string:navigator.userAgent,subString:"OmniWeb",versionSearch:"OmniWeb/",identity:"OmniWeb"},{string:navigator.vendor,subString:"Apple",identity:"Safari",versionSearch:"Version"},{prop:window.opera,identity:"Opera"},{string:navigator.vendor,subString:"iCab",identity:"iCab"},{string:navigator.vendor,subString:"KDE",identity:"Konqueror"},{string:navigator.userAgent,subString:"Firefox",identity:"Firefox"},{string:navigator.vendor,subString:"Camino",identity:"Camino"},{string:navigator.userAgent,subString:"Netscape",identity:"Netscape"},{string:navigator.userAgent,subString:"MSIE",identity:"Explorer",versionSearch:"MSIE"},{string:navigator.userAgent,subString:"Gecko",identity:"Mozilla",versionSearch:"rv"},{string:navigator.userAgent,subString:"Mozilla",identity:"Netscape",versionSearch:"Mozilla"}],os:[{string:navigator.platform,subString:"Win",identity:"Windows"},{string:navigator.platform,subString:"Mac",identity:"Mac"},{string:navigator.userAgent,subString:"iPhone",identity:"iPhone/iPod"},{string:navigator.platform,subString:"Linux",identity:"Linux"}]}}return w(a,b),a.prototype._makeMatch=function(a){var b,c,d,e,f,g;g=[];for(e=0,f=a.length;e<f;e++){d=a[e],c=d.string,b=d.prop,this._data.versionSearchString=d.versionSearch||d.identity;if(c!==null){if(d.string.indexOf(d.subString)!==-1)return d.identity}else if(b)return d.identity}return g},a.prototype._makeVersion=function(a){var b;b=a.indexOf(this._data.versionSearchString);if(b!==-1)return parseFloat(a.substring(b+this._data.versionSearchString.length+1))},a.prototype.discover=function(){var a,b,c,d,e;a=this._makeMatch(this._data.browsers)||"unknown",e=this._makeVersion(navigator.userAgent)||this._makeVersion(navigator.appVersion)||"unknown",c=this._makeMatch(this._data.os)||"unknown";if(a==="iPod/iPhone"||a==="Android")d="mobile",b=!1;return this.platform={os:c,type:d,vendor:navigator.vendor,product:navigator.product,browser:a,version:e,flags:{mobile:b,webkit:$.browser.webkit,msie:$.browser.msie,opera:$.browser.opera,mozilla:$.browser.mozilla}},this.capabilities={cookies:navigator.cookieEnabled,ajax:$.support.ajax,canvas:Modernizr.canvas,geolocation:Modernizr.geolocation,svg:Modernizr.svg,workers:Modernizr.webworkers,history:Modernizr.history,sockets:Modernizr.websockets,storage:{local:Modernizr.localstorage,session:Modernizr.sessionstorage,websql:Modernizr.websqldatabase,object:Modernizr.indexeddb}}},a}(),i=function(){function a(a){this.ui={indicators:{globalIndicatorQueue:0,currentGlobalProgress:0,startSpinner:function(){return this.globalIndicatorQueue===0&&$("#globalActivityIndicator").animate({opacity:1}).removeClass("hidden"),this.globalIndicatorQueue++},stopSpinner:function(){this.globalIndicatorQueue--;if(this.globalIndicatorQueue===0)return $("#globalActivityIndicator").animate({opacity:0},"fast",function(){return $(this).addClass("hidden")})},setGlobalProgressBar:function(a){return a==null&&(a=this.currentGlobalProgress+10),a>=100?$("#globalProgress").animate({width:$("#toploader").width()},function(){return $("#globalProgress").css({width:0})}):$("#globalProgress").animate({width:$("#toploader").width()*(a/100)}),this.currentGlobalProgress=a}}},this.events={registry:[],callchain:{},history:[],registerEvent:u(function(b){return this.events.registry.push(b),this.events.callchain[b]=[],a.dev.debug.eventlog===!0&&a.dev.verbose("EventLog","Event Registered: "+b),this},this),registerHook:u(function(b,c,d){var e;typeof d===null&&(d=!1),e={executed:!1,callback:function(a){return c(a)},runonce:d},this.events.callchain[b].push(e);if(a.dev.debug.verbose===!0)return a.dev.eventlog("Hook Registered",c,"on event",b)},this),triggerEvent:u(function(b,c){var d,e,f,g;a.dev.eventlog("Event Triggered",b,c||"{no context}");if(typeof this.events.callchain[b]!==null&&this.events.callchain[b].length>0){g=[];for(d in this.events.callchain[b]){if(this.events.callchain[b][d].executed===!0&&this.events.callchain[b][d].runonce===!0)continue;try{a.dev.debug.eventlog===!0&&a.dev.debug.verbose===!0&&a.dev.eventlog("Callchain",d,this.events.callchain[b]),e=this.events.callchain[b][d].callback(c),f={event:b,context:c,task:this.events.callchain[b][d],result:e}}catch(h){f={event:b,context:c,task:this.events.callchain[b][d],error:h},a.dev.error("Events","Calltask failed with error: ",h,f)}finally{this.events.history.push(f),this.events.callchain[b][d].executed=!0}}return g}},this)},this.session={_id:null,_token:null,_tokenHistory:[],getID:function(){return this._id!=null?this._id:!1},init:function(a,b){return this._id=a,this._token=b,this._tokenHistory.push(b)},renew:function(a){return this._token=a,this._tokenHistory.push(a)}},this.local={},this.elements={registry:{},get:function(a){return this.registry[a]},scan:function(){return $("[data-element]").each({buildElement:function(a,b){return this.register(b.attr("data-element"),this.factory(b.attr("data-element"),"#"+b.attr("id"),b.attr("data-element-type")||null))}}),this},factory:function(a,b,c,d){var e;return c==null&&(c="LayoutElement"),d==null&&(d={}),c===null&&(e=LayoutElement),c==="LayoutElement"?e=LayoutElement:c==="Panel"?e=Panel:c==="SuperPanel"?e=SuperPanel:c==="Navigation"&&(e=Navigation),new e(a,b,d)},register:u(function(b,c){var d;return this.events.registry[b]=c,d={id:b,element:c},a.state.events.triggerEvent("REGISTER_ELEMENT",d),this.elements.registry[b]},this),_setState:function(a,b,c){return this.registry[a]!==null&&this.registry[a]._setState(b,c),this},_getState:function(a,b,c){return c==null&&(c=null),this.registry[a]!==null?this.registry[a]._getState(b,c):c},_loadState:function(a,b){if(this.registry[a]===null)throw"Must register element before setting state!";return this.registry[a]._loadState(b),this}},this.events.registerEvent("SESSION_INIT"),this.events.registerEvent("SESSION_RENEW"),this.events.registerEvent("SESSION_CHECKIN"),this.events.registerEvent("SESSION_EXPIRE"),this.events.registerEvent("GLOBAL_ACTIVITY"),this.events.registerEvent("GLOBAL_ACTIVITY_FINISH"),this.events.registerHook("GLOBAL_ACTIVITY",u(function(){return this.ui.indicators.startSpinner()},this)),this.events.registerHook("GLOBAL_ACTIVITY_FINISH",u(function(){return this.ui.indicators.stopSpinner()},this))}return w(a,b),a}(),m=function(){function a(){a.__super__.constructor.apply(this,arguments)}return w(a,Backbone.Model),a.prototype._type=function(){return"local"},a}(),r=function(){function a(){a.__super__.constructor.apply(this,arguments)}return w(a,Backbone.Model),a.prototype._type=function(){return"remote"},a}(),n=function(){function a(){a.__super__.constructor.apply(this,arguments)}return w(a,Backbone.Collection),a.prototype._noop=function(){},a}(),g=function(){function a(a){window.Models={},a.state.events.registerEvent("MODEL_DEFINE"),a.state.events.registerEvent("MODEL_SYNC"),a.state.events.registerEvent("ENTITY_CREATE"),a.state.events.registerEvent("ENTITY_PUT"),a.state.events.registerEvent("ENTITY_GET"),a.state.events.registerEvent("ENTITY_DELETE"),this.local={schema:{}},this.remote={schema:{}},this.sync={_backboneSync:u(function(b,c,d){var e,f,g,h,i;h=d[0],f=d[1],e=3<=d.length?x.call(d,2):[];switch(b){case"create":return a.state.events.triggerEvent("ENTITY_CREATE",{model:c,options:d}),a.rpc.api.data.create({object:c}).fulfill({success:i,failure:g},e);case"read":return a.state.events.triggerEvent("ENTITY_GET",{model:c,options:d}),i=d[0],g=d[1],e=3<=d.length?x.call(d,2):[],a.rpc.api.data.get({key:c.id}).fulfill({success:i,failure:g},e);case"update":return a.state.events.triggerEvent("ENTITY_PUT",{model:c,options:d}),i=d[0],g=d[1],e=3<=d.length?x.call(d,2):[],a.rpc.api.data.update({key:c.id,object:c.toJSON()}).fulfill({success:i,failure:g},e);case"delete":return a.state.events.triggerEvent("ENTITY_DELETE",{model:c,options:d}),i=d[0],g=d[1],e=3<=d.length?x.call(d,2):[],a.rpc.api.data["delete"]({key:c.id}).fulfill({success:i,failure:g},e);default:return a.rpc.dev.error("Model","Backbone bridge model sync got an unrecognized method.",{method:b,model:c,options:d})}},this)},Backbone.sync=this.sync}return w(a,b),a}(),window.LocalModel=m,window.RemoteModel=r,window.ModelCollection=n,c=function(){function a(a){a.state.events.registerEvent("STORAGE_READ"),a.state.events.registerEvent("STORAGE_WRITE"),a.state.events.registerEvent("STORAGE_CLEAR"),a.state.events.registerEvent("STORAGE_DELETE"),a.state.events.registerEvent("STORAGE_DB_LOAD"),a.state.events.registerEvent("STORAGE_DB_CLOSE"),a.state.events.registerEvent("STORAGE_DB_QUERY"),a.state.events.registerEvent("STORAGE_DB_CREATE"),a.state.events.registerEvent("STORAGE_DB_DELETE"),a.state.events.registerEvent("STORAGE_DB_SETVERSION"),a.state.events.registerEvent("STORAGE_DB_TRANSACTION"),a.state.events.registerEvent("STORAGE_COLLECTION_CLEAR"),a.state.events.registerEvent("STORAGE_COLLECTION_CREATE"),a.state.events.registerEvent("STORAGE_COLLECTION_DELETE"),this.storage={local:{_driver:null,_resolveDriver:u(function(){return this.storage.local._driver=$.fatcatmap.sys.drivers.resolve("localstorage")},this),get:u(function(b){return this.storage.local._driver!==null?(a.state.events.triggerEvent("STORAGE_READ",{type:"local",mode:"key",key:b}),this.storage.local._driver.getValueByKey(b)):null},this),set:u(function(b,c){return this.storage.local._driver!==null?(a.state.events.triggerEvent("STORAGE_WRITE",{type:"local",key:b,value:c}),this.storage.local._driver.setValueByKey(b,c)):null},this),"delete":u(function(b){return this.storage.local._driver!==null?(a.state.events.triggerEvent("STORAGE_DELETE",{type:"local",key:b}),this.storage.local._driver.deleteByKey(b)):null},this),clear:u(function(){return this.storage.local._driver!==null?(a.state.events.triggerEvent("STORAGE_CLEAR",{type:"local"}),this._driver.nuke()):null},this),all:u(function(){return this.storage.local._driver!==null?(a.state.events.triggerEvent("STORAGE_READ",{type:"local",mode:"all"}),this.storage.local._driver.allValues()):null},this)},session:{_driver:null,_resolveDriver:u(function(){return this.storage.session._driver=$.fatcatmap.sys.drivers.resolve("sessionstorage")},this),get:u(function(b){return this.storage.session._driver!==null?(a.state.events.triggerEvent("STORAGE_READ",{type:"session",mode:"key",key:b}),this.storage.session._driver.getValueByKey(b)):null},this),set:u(function(b,c){return this.storage.session._driver!==null?(a.state.events.triggerEvent("STORAGE_WRITE",{type:"session",key:b,value:c}),this.storage.session._driver.setValueByKey(b,c)):null},this),"delete":u(function(a){return this.storage.session._driver!==null?(this.fcm.state.events.triggerEvent("STORAGE_DELETE",{type:"session",key:a}),this.storage.session._driver.deleteByKey(a)):null},this),clear:u(function(){return this.storage.session._driver!==null?(a.state.events.triggerEvent("STORAGE_CLEAR",{type:"session"}),this.storage.session._driver.nuke()):null},this),all:u(function(){return this.storage.session._driver!==null?(a.state.events.triggerEvent("STORAGE_READ",{type:"session",mode:"all"}),this.storage.session._driver.allValues()):null},this)},object:{_driver:null,_resolveDriver:u(function(){return this.storage.object._driver=$.fatcatmap.sys.drivers.resolve("objectstorage")},this),_dbError:u(function(b){return a.dev.error("Storage","Error encountered in OBJECT storage.",b)},this),get:u(function(){var a,b;return a=1<=arguments.length?x.call(arguments,0):[],this._driver!=null&&this._resolveDriver(),(b=this._driver).get.apply(b,a)},this),keys:u(function(){var a,b;return a=1<=arguments.length?x.call(arguments,0):[],this._driver!=null&&this._resolveDriver(),(b=this._driver).keys.apply(b,a)},this),batch:u(function(){var a,b;return a=1<=arguments.length?x.call(arguments,0):[],this._driver!=null&&this._resolveDriver(),(b=this._driver).batch.apply(b,a)},this),save:u(function(){var a,b;return a=1<=arguments.length?x.call(arguments,0):[],this._driver!=null&&this._resolveDriver(),(b=this._driver).save.apply(b,a)},this),exists:u(function(){var a,b;return a=1<=arguments.length?x.call(arguments,0):[],this._driver!=null&&this._resolveDriver(),(b=this._driver).exists.apply(b,a)},this),each:u(function(){var a,b;return a=1<=arguments.length?x.call(arguments,0):[],this._driver!=null&&this._resolveDriver(),(b=this._driver).each.apply(b,a)},this),all:u(function(){var a,b;return a=1<=arguments.length?x.call(arguments,0):[],this._driver!=null&&this._resolveDriver(),(b=this._driver).all.apply(b,a)},this),remove:u(function(){var a,b;return a=1<=arguments.length?x.call(arguments,0):[],this._driver!=null&&this._resolveDriver(),(b=this._driver).remove.apply(b,a)},this),nuke:u(function(){var a,b;return a=1<=arguments.length?x.call(arguments,0):[],this._driver!=null&&this._resolveDriver(),(b=this._driver).nuke.apply(b,a)},this)}},this.layout={register:u(function(b,c){return c.register(b),a.state.elements.register(b,c)},this),render:u(function(a,b){},this),renderTemplate:u(function(){var a,b;b=arguments[0],a=2<=arguments.length?x.call(arguments,1):[]},this)},a.state.events.registerEvent("MAP_REGISTERED"),a.state.events.registerEvent("MAP_DATA_CHANGE"),a.state.events.registerEvent("MAP_NODE_ADDED"),a.state.events.registerEvent("MAP_EDGE_ADDED"),a.state.events.registerEvent("MAP_DRAW"),a.state.events.registerEvent("MAP_SHIFT_ORIGIN"),this.visualizer={graph:{currentGraph:null,register:function(a){this.currentGraph=a},showMore:function(a){var b,c;return $("#nodeDetails #node_label").text(a.label),$("#nodeDetails #node_kind").text(a.kind),b="",c=this.currentGraph.index.neighbors_by_node[a.key.encoded],_.each(c,u(function(a){return b+='<li><a href="#">'+a.label+"</a></li>"},this)),$("#nodeDetails #node_outgoing_edges").html(b)}}}}return w(a,b),a}(),k=function(){function a(a){a.state.events.registerEvent("USER_CHANGE"),this.current_user=null,this.is_user_admin=null,this.login_url=null,this.logout_url=null}return w(a,b),a.prototype.setUserInfo=function(a){var b,c;return b={},a.current_user!==null&&(this.current_user=a.current_user,b.current_user=this.current_user),a.is_user_admin!==null&&(this.is_user_admin=a.is_user_admin,b.is_user_admin=this.is_user_admin),a.login_url!==null&&(this.login_url=a.login_url,b.login_url=this.login_url),a.logout_url!==null&&(this.logout_url=a.logout_url,b.logout_url=this.logout_url),typeof $!="undefined"&&$!==null?c=$.fatcatmap:c=window.fatcatmap,c.state.events.triggerEvent("USER_CHANGE",b)},a}(),o=function(){function a(a,b,c,d){var e,f,g,h;this.name=a,this.base_uri=b,this.methods=c,this.config=d;if(this.methods.length>0){h=this.methods;for(f=0,g=h.length;f<g;f++)e=h[f],this[e]=this._buildRPCMethod(e,b,d)}}return a.prototype._buildRPCMethod=function(a,b,c){var d,e;return d=this.name,e=u(function(b,c,e,f){return b==null&&(b={}),c==null&&(c=null),e==null&&(e=!1),f==null&&(f={}),u(function(b,c,e,f){var g,h;return b==null&&(b={}),c==null&&(c=null),e==null&&(e=!1),f==null&&(f={}),typeof $!="undefined"&&$!==null?g=$.fatcatmap:g=window.fatcatmap,h=g.rpc.api.createRPCRequest({method:a,api:d,params:b||{},opts:f||{},async:e||!1}),c!==null?h.fulfill(c):h},this)(b,c,e,f)},this),typeof $!="undefined"&&$!==null?$.fatcatmap.rpc.registerAPIMethod(d,a,b,c):window.fatcatmap.rpc.registerAPIMethod(d,a,b,c),e},a}(),p=function(){function a(a){this.name=a}return a.prototype.request=function(a){return a},a.prototype.response=function(a,b){if(y.call(b,"success")>=0)return window.fatcatmap.rpc.adapters.makeCallback(a,b.success)},a}(),q=function(){function a(a,b,c){this.params={},this.action=null,this.method=null,this.api=null,this.base_uri=null,this.envelope={id:null,opts:{},agent:{}},this.ajax={async:!1,cache:!0,global:!0,http_method:"POST",crossDomain:!1,ifModified:!1,dataType:"json",contentType:"application/json"},a!=null&&(this.envelope.id=a),b!=null&&(this.envelope.opts=b),c!=null&&(this.envelope.agent=c)}return a.prototype.fulfill=function(){var a,b,c,d;a=arguments[0],b=2<=arguments.length?x.call(arguments,1):[];if(a!=null?!a.success:!void 0)d=u(function(a){return $.fatcatmap.dev.log("RPC","RPC succeeded but had no success callback.",this)},this),a.success=d;if(a!=null?!a.failure:!void 0)c=u(function(a){return $.fatcatmap.dev.error("RPC","RPC failed but had no failure callback.",this)},this),a.failure=c;return window.fatcatmap.rpc.api.fulfillRPCRequest(b,this,a)},a.prototype.setAsync=function(a){var b,c;return(b=this.ajax)!=null&&(c=b.async)==null&&(b.async=a),this},a.prototype.setOpts=function(a){var b,c;return(b=this.envelope)!=null&&(c=b.opts)==null&&(b.opts=a),this},a.prototype.setAgent=function(a){var b,c;return(b=this.envelope)!=null&&(c=b.agent)==null&&(b.agent=a),this},a.prototype.setAction=function(a){return this.action=a,this},a.prototype.setMethod=function(a){return this.method=a,this},a.prototype.setAPI=function(a){return this.api=a,this},a.prototype.setBaseURI=function(a){return this.base_uri=a,this},a.prototype.setParams=function(a){return this.params=a!=null?a:{},this},a.prototype.payload=function(){var a;return a={id:this.envelope.id,opts:this.envelope.opts,agent:this.envelope.agent,request:{params:this.params,method:this.method,api:this.api}},a},a}(),h=function(){function a(a){var b;a.state.events.registerEvent("RPC_CREATE"),a.state.events.registerEvent("RPC_FULFILL"),a.state.events.registerEvent("RPC_SUCCESS"),a.state.events.registerEvent("RPC_ERROR"),a.state.events.registerEvent("RPC_COMPLETE"),a.state.events.registerEvent("RPC_PROGRESS"),window.amplify!=null&&(a.dev.verbose("RPC","AmplifyJS detected. Registering."),a.sys.drivers.register("transport","amplify",window.amplify,!0,!0)),this.base_rpc_uri="/_api/rpc",b=$.ajaxSettings.xhr,this.internals={transports:{xhr:{factory:u(function(){var a;return a=b(),a&&typeof a.addEventListener=="function"&&a.addEventListener("progress",u(function(a){return $.fatcatmap.state.events.triggerEvent("RPC_PROGRESS",{event:a})},this),!1),a},this)}}},$.ajaxSetup({global:!0,xhr:u(function(){return this.internals.transports.xhr.factory()},this)}),this.api={lastRequest:null,lastFailure:null,lastResponse:null,action_prefix:null,history:{},used_ids:[],factory:function(a,b,c,d){return this[a]=new o(a,b,c,d)},_assembleRPCURL:function(a,b,c,d){b==null&&(b=null),c==null&&(c=null),d==null&&(d=null);if(b===null&&d===null)throw"[RPC] Error: Must specify either an API or base URI to generate an RPC endpoint.";return d===null&&(d=window.fatcatmap.rpc.api[b].base_uri),c!==null?[c+d,a].join("."):[d,a].join(".")},provisionRequestID:function(){var a;return this.used_ids.length>0?(a=Math.max.apply(this,this.used_ids)+1,this.used_ids.push(a),a):(this.used_ids.push(1),1)},decodeRPCResponse:function(a,b,c,d,e){return d(a,b)},createRPCRequest:function(a){var b;return b=new q(this.provisionRequestID()),a.api!=null&&b.setAPI(a.api),a.method!=null&&b.setMethod(a.method),a.agent!=null&&b.setAgent(a.agent),a.opts!=null&&b.setOpts(a.opts),a.base_uri!=null&&b.setBaseURI(a.base_uri),a.params!=null&&b.setParams(a.params),a.async!=null&&b.setAsync(a.async),typeof $!="undefined"&&$!==null?$.fatcatmap.dev.log("RPC","New Request",b,a):window.fatcatmap.dev.log("RPC","New Request",b,a),b.setAction(this._assembleRPCURL(b.method,b.api,this.action_prefix,this.base_rpc_uri)),b},fulfillRPCRequest:function(b,c,d){var e;typeof $!="undefined"&&$!==null?$.fatcatmap.dev.log("RPC","Fulfill",b,c,d):window.fatcatmap.dev.log("RPC","Fulfill",b,c,d),this.lastRequest=c,this.history[c.envelope.id]={request:c,config:b,callbacks:d};if(c.action===null){if(c.method===null)throw"[RPC] Error: Request must specify at least an action or method.";if(c.base_uri===null){if(c.api===null)throw"[RPC] Error: Request must have an API or explicity BASE_URI.";c.action=this._assembleRPCURL(c.method,c.api,this.action_prefix)}else c.action=this._assembleRPCURL(c.method,null,this.action_prefix,c.base_uri)}if(c.action===null||c.action===void 0)throw"[RPC] Error: Could not determine RPC action.";return e={config:b,request:c,callbacks:d},a.state.events.triggerEvent("RPC_FULFILL",e),function(b,c){var d,f,g,h,i;return f=window.fatcatmap,i={resourceId:b.api+"."+b.method,url:b.action,data:JSON.stringify(b.payload()),async:b.ajax.async,global:b.ajax.global,type:b.ajax.http_method,crossDomain:b.ajax.crossDomain,dataType:b.ajax.dataType,processData:!1,ifModified:b.ajax.ifModified,contentType:b.ajax.contentType,beforeSend:u(function(a,d){return f.rpc.api.history[b.envelope.id].xhr=a,c!=null&&typeof c.status=="function"&&c.status("beforeSend"),a},this),error:u(function(d,g,h){return c!=null&&typeof c.status=="function"&&c.status("error"),f.dev.error("RPC","Error: ",{error:h,status:g,xhr:d}),f.rpc.api.lastFailure=h,f.rpc.api.history[b.envelope.id].xhr=d,f.rpc.api.history[b.envelope.id].status=g,f.rpc.api.history[b.envelope.id].failure=h,e={xhr:d,status:g,error:h},f.state.events.triggerEvent("RPC_ERROR",e),a.state.events.triggerEvent("RPC_COMPLETE",e),c!=null?typeof c.failure=="function"?c.failure(h):void 0:void 0},this),success:u(function(d,g,h){if(d.status==="ok")return c!=null&&typeof c.status=="function"&&c.status("success"),f.dev.log("RPC","Success",d,g,h),f.rpc.api.lastResponse=d,f.rpc.api.history[b.envelope.id].xhr=h,f.rpc.api.history[b.envelope.id].status=g,f.rpc.api.history[b.envelope.id].response=d,e={xhr:h,status:g,data:d},a.state.events.triggerEvent("RPC_SUCCESS",e),a.state.events.triggerEvent("RPC_COMPLETE",e),f.dev.verbose("RPC","Success callback",c),c!=null?typeof c.success=="function"?c.success(d.response.content,d.response.type,d):void 0:void 0;if(d.status==="failure")return c!=null&&typeof c.status=="function"&&c.status("error"),f.dev.error("RPC","Error: ",{error:error,status:g,xhr:h}),f.rpc.api.lastFailure=error,f.rpc.api.history[b.envelope.id].xhr=h,f.rpc.api.history[b.envelope.id].status=g,f.rpc.api.history[b.envelope.id].failure=error,e={xhr:h,status:g,error:error},f.state.events.triggerEvent("RPC_ERROR",e),a.state.events.triggerEvent("RPC_COMPLETE",e),c!=null?typeof c.failure=="function"?c.failure(error):void 0:void 0},this),statusCode:{404:function(){return f.dev.error("RPC","HTTP/404","Could not resolve RPC action URI."),f.state.events.triggerEvent("RPC_ERROR",{message:"RPC 404: Could not resolve RPC action URI.",code:404})},403:function(){return f.dev.error("RPC","HTTP/403","Not authorized to access the specified endpoint."),f.state.events.triggerEvent("RPC_ERROR",{message:"RPC 403: Not authorized to access the specified endpoint.",code:403})},500:function(){return f.dev.error("RPC","HTTP/500","Internal server error."),f.state.events.triggerEvent("RPC_ERROR",{message:"RPC 500: Woops! Something went wrong. Please try again.",code:500})}}},d=f.sys.drivers.resolve("transport","amplify"),d!=null&&d===!0?(f.dev.verbose("RPC","Fulfilling with AmplifyJS adapter."),h=d.request,g=h(i)):(f.dev.verbose("RPC","Fulfilling with AJAX adapter."),g=$.ajax(i)),f.dev.verbose("RPC","Resulting XHR: ",g)}(c,d),{id:c.envelope.id,request:c}}},this.adapters={data:new p("data"),query:new p("query"),graph:new p("graph"),charts:new p("charts"),session:new p("session"),frame:new p("frame")},this.ext=null,a.state.events.registerHook("RPC_FULFILL",function(){return $.fatcatmap.state.events.triggerEvent("GLOBAL_ACTIVITY")}),a.state.events.registerHook("RPC_COMPLETE",function(){return $.fatcatmap.state.events.triggerEvent("GLOBAL_ACTIVITY_FINISH")}),a.state.events.registerHook("RPC_PROGRESS",function(a){return console.log("progress",a)})}return w(a,b),a.prototype.registerAPIMethod=function(a,b,c,d){var e,f,g,h;typeof $!="undefined"&&$!==null?g=$.fatcatmap:g=window.fatcatmap,e=g.sys.drivers.resolve("transport","amplify");if(e!==!1)return g.dev.log("RPCAPI",'Registering request procedure "'+a+"."+b+'" with AmplifyJS.'),h=a+"."+b,f={type:"POST",dataType:"json",contentType:"application/json",url:this.api._assembleRPCURL(b,a,null,c),decoder:this.api.decodeRPCResponse},d.caching!=null?(d.caching===!0&&(f.caching="persist"),e.request.define(h,"ajax",f)):e.request.define(h,"ajax",f)},a}(),window.RPCAPI=o,window.RPCAdapter=p,window.RPCRequest=q,s=function(){function a(a,b,c){this.name=a,this.path=b,this.config=c}return a}(),f=function(){function a(a){this.fcm=a,this.onClose=u(this.onClose,this),this.onError=u(this.onError,this),this.onMessage=u(this.onMessage,this),this.onOpen=u(this.onOpen,this),this.dispatch=u(this.dispatch,this),this.listen=u(this.listen,this),this.openChannel=u(this.openChannel,this),this.defaultLiveFailureHandler=u(this.defaultLiveFailureHandler,this),this.defaultLiveSuccessHandler=u(this.defaultLiveSuccessHandler,this),this.fcm.state.events.registerEvent("CHANNEL_OPEN"),this.fcm.state.events.registerEvent("CHANNEL_MESSAGE"),this.fcm.state.events.registerEvent("CHANNEL_ERROR"),this.fcm.state.events.registerEvent("CHANNEL_CLOSE"),this.token=null,this.channel=null,this.socket=null,this.handlers={_registry:{"default":this.defaultLiveHandler},add:function(a,b){this.registry[a]=b},remove:function(a){this.registry[a]=null},resolve:function(a){return y.call(this.registry,a)>=0?this.registry[a]:!1},handle:function(a,b){return this.registry[a](b)}}}return w(a,b),a.prototype.defaultLiveSuccessHandler=function(){var a,b;a=1<=arguments.length?x.call(arguments,0):[],(b=this.fcm.dev.debug).log.apply(b,["CoreLive","Live API received unhandled successful push message."].concat(x.call(a)))},a.prototype.defaultLiveFailureHandler=function(){var a,b;a=1<=arguments.length?x.call(arguments,0):[],(b=this.fcm.dev.debug).log.apply(b,["CoreLive","Live API received unhandled push message failure."].concat(x.call(a)))},a.prototype.openChannel=function(a){var b;this.token=a,this.fcm.dev.debug.log("CoreLive","Opening channel.",this.token);try{this.channel=typeof goog!="undefined"&&goog!==null?(b=goog.appengine)!=null?new b.Channel(this.token):void 0:void 0,this.socket=this.channel.open(),this.socket.onopen=this.onOpen,this.socket.onmessage=this.onMessage,this.socket.onerror=this.onError,this.socket.onclose=this.onClose}catch(c){return this.fcm.dev.debug.error("CoreLive","Encountered error preparing live channel.",c),{channel:!1,socket:!1}}return{channel:channel,socket:socket}},a.prototype.listen=function(a){var b,c,d;if(this.channel===null&&this.socket===null){d=this.openChannel(a),b=d.channel,c=d.socket;if(b!=null&&c!=null)return this.fcm.state.events.registerHook("CHANNEL_OPEN",this.dispatch)}},a.prototype.dispatch=function(a){if(a.status==="ok"){if(this.handlers.resolve(a.response.type))return this.handlers.handle(a.response.type,a);this.defaultLiveSuccessHandler(a)}else{if(this.handlers.resolve(a.response.type))return this.handlers.handle(a.error.type,a);this.defaultLiveFailureHandler(a)}},a.prototype.onOpen=function(){return this.fcm.dev.debug.log("CoreLive","Channel is ready to receive live messages."),this.fcm.state.events.triggerEvent("CHANNEL_OPEN")},a.prototype.onMessage=function(a){return this.fcm.dev.debug.verbose("CoreLive","Channel message received.",a),this.fcm.state.events.triggerEvent("CHANNEL_MESSAGE",a)},a.prototype.onError=function(a){return this.fcm.dev.debug.error("CoreLive","Encountered channel error.",a),this.fcm.state.events.triggerEvent("CHANNEL_ERROR",a)},a.prototype.onClose=function(){return this.fcm.dev.debug.log("CoreLive","Channel has been closed."),this.fcm.state.events.triggerEvent("CHANNEL_CLOSE")},a}(),t=function(){function c(){}var a,b;return a="StorageDriver",b={},c.prototype.setup=function(a,b){return this.name=a,this.config=b,$.fatcatmap.sys.drivers.register(this.name,"native",typeof this.init=="function"?this.init():void 0,999,!0)},c.prototype.getValueByKey=function(a,b){},c.prototype.setValueByKey=function(a,b,c){},c.prototype.addValueByKey=function(a,b,c){},c.prototype.deleteByKey=function(a,b){},c.prototype.nuke=function(){},c.prototype.allValues=function(){},c}(),a=function(){function a(){a.__super__.constructor.apply(this,arguments)}return w(a,t),a.prototype.openDatabase=function(a,b){},a.prototype.deleteDatabase=function(a,b){},a.prototype.setDatabaseVerison=function(a,b,c){},a.prototype.closeDatabase=function(a,b){},a.prototype.createCollection=function(a,b,c,d,e){},a.prototype.deleteCollection=function(a,b,c){},a.prototype.clearCollection=function(a,b,c){},a}(),this.StorageDriver=t,this.AdvancedStorageDriver=a,l=function(){function a(a){return this.config=a,this.dev=new e(this),this.sys=new j(this),this.agent=new d(this),this.agent.discover(),this.state=new i(this),this.state.events.registerEvent("RPC_READY"),this.state.events.registerEvent("API_READY"),this.state.events.registerEvent("CORE_READY"),this.state.events.registerEvent("DRIVER_REGISTERED"),this.state.events.registerEvent("REGISTER_ELEMENT"),this.state.events.registerEvent("PLATFORM_READY"),this.state.events.triggerEvent("GLOBAL_ACTIVITY"),this.state.events.registerHook("PLATFORM_READY",u(function(){return this.state.events.triggerEvent("GLOBAL_ACTIVITY_FINISH")},this)),this.model=new g(this),this.api=new c(this),this.user=new k(this),this.rpc=new h(this),this.live=new f(this),this}return a}(),window.fatcatmap=new l,typeof $!="undefined"&&$!==null&&$.extend({fatcatmap:window.fatcatmap}),window.fatcatmap.state.events.triggerEvent("CORE_READY")}).call(this)